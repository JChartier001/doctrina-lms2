# Story 110.1: Fix TypeScript Errors Across Codebase

Status: Draft

## Story

As a **developer**,
I want **all TypeScript errors resolved across the codebase**,
so that **the TypeScript compiler passes without errors and we have full type safety**.

## Acceptance Criteria

1. **AC-110.1:** TypeScript compiler passes with zero errors
   - **Given:** Running `yarn typescript` command
   - **When:** TypeScript checks all files
   - **Then:** Zero errors reported (warnings are acceptable)

2. **AC-110.2:** All type mismatches resolved
   - **Given:** 185 TypeScript errors across 40 files
   - **When:** All type annotations corrected
   - **Then:** Properties exist on types, assignments are type-safe

3. **AC-110.3:** No `any` types remain except where explicitly needed
   - **Given:** Unknown types and implicit any errors
   - **When:** Proper type annotations added
   - **Then:** All variables have explicit types

## Tasks / Subtasks

- [ ] **Task 1:** Fix Convex ID type mismatches (30+ errors)
  - [ ] Subtask 1.1: Fix user.id vs Id<'users'> type errors
  - [ ] Subtask 1.2: Fix session IDs and resource IDs
  - [ ] Subtask 1.3: Add type assertions where Clerk IDs used with Convex

- [ ] **Task 2:** Fix missing properties on schema types (50+ errors)
  - [ ] Subtask 2.1: liveSessions - add instructorName, participants, id properties
  - [ ] Subtask 2.2: courses - add students property
  - [ ] Subtask 2.3: resources - ensure type field is ResourceType enum
  - [ ] Subtask 2.4: notifications - add id property
  - [ ] Subtask 2.5: users - ensure role/isVerified properties

- [ ] **Task 3:** Fix component prop type errors (40+ errors)
  - [ ] Subtask 3.1: Fix SearchResultType to include all types (program, instructor, community, lesson)
  - [ ] Subtask 3.2: Fix chart component payload types
  - [ ] Subtask 3.3: Fix date-range-picker DateRange types
  - [ ] Subtask 3.4: Fix Resource type vs schema mismatch

- [ ] **Task 4:** Fix duplicate variable declarations (10+ errors)
  - [ ] Subtask 4.1: Fix hasPurchased redeclaration in courses/[id]/page.tsx
  - [ ] Subtask 4.2: Fix courseData/setCourseData in wizard/page.tsx

- [ ] **Task 5:** Fix missing imports and exports (15+ errors)
  - [ ] Subtask 5.1: Add formatRelativeTime export to notification-service
  - [ ] Subtask 5.2: Add getCertificateTemplate to certificate-service
  - [ ] Subtask 5.3: Add getSimilarCourses to recommendation-service
  - [ ] Subtask 5.4: Add useState to resource-card component

- [ ] **Task 6:** Fix unknown type assertions (20+ errors)
  - [ ] Subtask 6.1: Add type guards for unknown types in search results
  - [ ] Subtask 6.2: Fix session type in checkout/success
  - [ ] Subtask 6.3: Fix error type annotations

- [ ] **Task 7:** Verify build passes
  - [ ] Subtask 7.1: Run `yarn typescript` - verify 0 errors
  - [ ] Subtask 7.2: Run `yarn lint` - verify only warnings remain
  - [ ] Subtask 7.3: Run `yarn build` - verify successful build

## Dev Notes

### Error Categories Identified

**185 Total Errors Across:**

- app/ directory: 80 errors (20 files)
- components/ directory: 95 errors (15 files)
- convex/ directory: 8 errors (3 files)
- lib/ directory: 2 errors (1 file)

**Root Causes:**

1. **Convex ID vs String types:** Clerk returns string IDs, Convex expects Id<'table'> types
2. **Mock data properties:** Mock objects have properties not in actual schema
3. **Schema evolution:** Frontend code references old schema properties
4. **Type imports:** Missing or incorrect type definitions
5. **Component prop interfaces:** Outdated prop definitions

### Architecture Patterns

**Convex ID Pattern:**

```typescript
// Wrong:
const result = someFunction(user?.id); // user.id is string

// Right:
const convexUser = await ctx.db
	.query('users')
	.withIndex('by_externalId', q => q.eq('externalId', user.id))
	.first();
const result = someFunction(convexUser?._id); // _id is Id<'users'>
```

**Type Safety Strategy:**

1. Fix schema first - ensure all referenced properties exist
2. Update service layer - proper type exports
3. Fix components - use correct prop interfaces
4. Add type guards where unions exist

### References

- **[Source: TypeScript Error Log]** - 185 errors cataloged by file and category
- **[Source: convex/schema.ts]** - Source of truth for data models
- **[Source: docs/DB-SCHEMA.md]** - Database schema documentation (if exists)

### Estimated Effort

- **Story Points:** 21 (2-3 hours)
- **Priority:** P1 - High (blocks clean builds, but doesn't block runtime)
- **Sprint:** Sprint 2 cleanup or Sprint 3

## Dev Agent Record

### Context Reference

<!-- Will be generated by story-context workflow -->

### Agent Model Used

Claude Sonnet 4.5 (1M context) - Model ID: claude-sonnet-4-5-20250929

### Debug Log References

<!-- Will be populated during development -->

### Completion Notes List

<!-- Will be populated by dev agent after implementation -->

### File List

**Files to Fix (40 files):**

- See TypeScript error log for complete list

**Key Files:**

- `convex/schema.ts` - May need property additions
- `lib/*-service.ts` - Missing exports
- `app/**/*.tsx` - Type assertions and corrections
- `components/**/*.tsx` - Prop interface updates
